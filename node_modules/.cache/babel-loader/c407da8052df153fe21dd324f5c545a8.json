{"ast":null,"code":"/*\n\tcompiles a selector to an executable function\n*/\nmodule.exports = compile;\nmodule.exports.compileUnsafe = compileUnsafe;\nmodule.exports.compileToken = compileToken;\n\nvar parse = require(\"css-what\"),\n    DomUtils = require(\"domutils\"),\n    isTag = DomUtils.isTag,\n    Rules = require(\"./general.js\"),\n    sortRules = require(\"./sort.js\"),\n    BaseFuncs = require(\"boolbase\"),\n    trueFunc = BaseFuncs.trueFunc,\n    falseFunc = BaseFuncs.falseFunc,\n    procedure = require(\"./procedure.json\");\n\nfunction compile(selector, options, context) {\n  var next = compileUnsafe(selector, options, context);\n  return wrap(next);\n}\n\nfunction wrap(next) {\n  return function base(elem) {\n    return isTag(elem) && next(elem);\n  };\n}\n\nfunction compileUnsafe(selector, options, context) {\n  var token = parse(selector, options);\n  return compileToken(token, options, context);\n}\n\nfunction includesScopePseudo(t) {\n  return t.type === \"pseudo\" && (t.name === \"scope\" || Array.isArray(t.data) && t.data.some(function (data) {\n    return data.some(includesScopePseudo);\n  }));\n}\n\nvar DESCENDANT_TOKEN = {\n  type: \"descendant\"\n},\n    SCOPE_TOKEN = {\n  type: \"pseudo\",\n  name: \"scope\"\n},\n    PLACEHOLDER_ELEMENT = {},\n    getParent = DomUtils.getParent; //CSS 4 Spec (Draft): 3.3.1. Absolutizing a Scope-relative Selector\n//http://www.w3.org/TR/selectors4/#absolutizing\n\nfunction absolutize(token, context) {\n  //TODO better check if context is document\n  var hasContext = !!context && !!context.length && context.every(function (e) {\n    return e === PLACEHOLDER_ELEMENT || !!getParent(e);\n  });\n  token.forEach(function (t) {\n    if (t.length > 0 && isTraversal(t[0]) && t[0].type !== \"descendant\") {//don't return in else branch\n    } else if (hasContext && !includesScopePseudo(t)) {\n      t.unshift(DESCENDANT_TOKEN);\n    } else {\n      return;\n    }\n\n    t.unshift(SCOPE_TOKEN);\n  });\n}\n\nfunction compileToken(token, options, context) {\n  token = token.filter(function (t) {\n    return t.length > 0;\n  });\n  token.forEach(sortRules);\n  var isArrayContext = Array.isArray(context);\n  context = options && options.context || context;\n  if (context && !isArrayContext) context = [context];\n  absolutize(token, context);\n  return token.map(function (rules) {\n    return compileRules(rules, options, context, isArrayContext);\n  }).reduce(reduceRules, falseFunc);\n}\n\nfunction isTraversal(t) {\n  return procedure[t.type] < 0;\n}\n\nfunction compileRules(rules, options, context, isArrayContext) {\n  var acceptSelf = isArrayContext && rules[0].name === \"scope\" && rules[1].type === \"descendant\";\n  return rules.reduce(function (func, rule, index) {\n    if (func === falseFunc) return func;\n    return Rules[rule.type](func, rule, options, context, acceptSelf && index === 1);\n  }, options && options.rootFunc || trueFunc);\n}\n\nfunction reduceRules(a, b) {\n  if (b === falseFunc || a === trueFunc) {\n    return a;\n  }\n\n  if (a === falseFunc || b === trueFunc) {\n    return b;\n  }\n\n  return function combine(elem) {\n    return a(elem) || b(elem);\n  };\n} //:not, :has and :matches have to compile selectors\n//doing this in lib/pseudos.js would lead to circular dependencies,\n//so we add them here\n\n\nvar Pseudos = require(\"./pseudos.js\"),\n    filters = Pseudos.filters,\n    existsOne = DomUtils.existsOne,\n    isTag = DomUtils.isTag,\n    getChildren = DomUtils.getChildren;\n\nfunction containsTraversal(t) {\n  return t.some(isTraversal);\n}\n\nfilters.not = function (next, token, options, context) {\n  var opts = {\n    xmlMode: !!(options && options.xmlMode),\n    strict: !!(options && options.strict)\n  };\n\n  if (opts.strict) {\n    if (token.length > 1 || token.some(containsTraversal)) {\n      throw new SyntaxError(\"complex selectors in :not aren't allowed in strict mode\");\n    }\n  }\n\n  var func = compileToken(token, opts, context);\n  if (func === falseFunc) return next;\n  if (func === trueFunc) return falseFunc;\n  return function (elem) {\n    return !func(elem) && next(elem);\n  };\n};\n\nfilters.has = function (next, token, options) {\n  var opts = {\n    xmlMode: !!(options && options.xmlMode),\n    strict: !!(options && options.strict)\n  }; //FIXME: Uses an array as a pointer to the current element (side effects)\n\n  var context = token.some(containsTraversal) ? [PLACEHOLDER_ELEMENT] : null;\n  var func = compileToken(token, opts, context);\n  if (func === falseFunc) return falseFunc;\n  if (func === trueFunc) return function (elem) {\n    return getChildren(elem).some(isTag) && next(elem);\n  };\n  func = wrap(func);\n\n  if (context) {\n    return function has(elem) {\n      return next(elem) && (context[0] = elem, existsOne(func, getChildren(elem)));\n    };\n  }\n\n  return function has(elem) {\n    return next(elem) && existsOne(func, getChildren(elem));\n  };\n};\n\nfilters.matches = function (next, token, options, context) {\n  var opts = {\n    xmlMode: !!(options && options.xmlMode),\n    strict: !!(options && options.strict),\n    rootFunc: next\n  };\n  return compileToken(token, opts, context);\n};","map":{"version":3,"sources":["/Users/dhruv/Sneaks/sneaks-website/node_modules/cheerio/node_modules/css-select/lib/compile.js"],"names":["module","exports","compile","compileUnsafe","compileToken","parse","require","DomUtils","isTag","Rules","sortRules","BaseFuncs","trueFunc","falseFunc","procedure","selector","options","context","next","wrap","base","elem","token","includesScopePseudo","t","type","name","Array","isArray","data","some","DESCENDANT_TOKEN","SCOPE_TOKEN","PLACEHOLDER_ELEMENT","getParent","absolutize","hasContext","length","every","e","forEach","isTraversal","unshift","filter","isArrayContext","map","rules","compileRules","reduce","reduceRules","acceptSelf","func","rule","index","rootFunc","a","b","combine","Pseudos","filters","existsOne","getChildren","containsTraversal","not","opts","xmlMode","strict","SyntaxError","has","matches"],"mappings":"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","sourcesContent":["/*\n\tcompiles a selector to an executable function\n*/\n\nmodule.exports = compile;\nmodule.exports.compileUnsafe = compileUnsafe;\nmodule.exports.compileToken = compileToken;\n\nvar parse       = require(\"css-what\"),\n    DomUtils    = require(\"domutils\"),\n    isTag       = DomUtils.isTag,\n    Rules       = require(\"./general.js\"),\n    sortRules   = require(\"./sort.js\"),\n    BaseFuncs   = require(\"boolbase\"),\n    trueFunc    = BaseFuncs.trueFunc,\n    falseFunc   = BaseFuncs.falseFunc,\n    procedure   = require(\"./procedure.json\");\n\nfunction compile(selector, options, context){\n\tvar next = compileUnsafe(selector, options, context);\n\treturn wrap(next);\n}\n\nfunction wrap(next){\n\treturn function base(elem){\n\t\treturn isTag(elem) && next(elem);\n\t};\n}\n\nfunction compileUnsafe(selector, options, context){\n\tvar token = parse(selector, options);\n\treturn compileToken(token, options, context);\n}\n\nfunction includesScopePseudo(t){\n    return t.type === \"pseudo\" && (\n        t.name === \"scope\" || (\n            Array.isArray(t.data) &&\n            t.data.some(function(data){\n                return data.some(includesScopePseudo);\n            })\n        )\n    );\n}\n\nvar DESCENDANT_TOKEN = {type: \"descendant\"},\n    SCOPE_TOKEN = {type: \"pseudo\", name: \"scope\"},\n    PLACEHOLDER_ELEMENT = {},\n    getParent = DomUtils.getParent;\n\n//CSS 4 Spec (Draft): 3.3.1. Absolutizing a Scope-relative Selector\n//http://www.w3.org/TR/selectors4/#absolutizing\nfunction absolutize(token, context){\n    //TODO better check if context is document\n    var hasContext = !!context && !!context.length && context.every(function(e){\n        return e === PLACEHOLDER_ELEMENT || !!getParent(e);\n    });\n\n\n    token.forEach(function(t){\n        if(t.length > 0 && isTraversal(t[0]) && t[0].type !== \"descendant\"){\n            //don't return in else branch\n        } else if(hasContext && !includesScopePseudo(t)){\n            t.unshift(DESCENDANT_TOKEN);\n        } else {\n            return;\n        }\n\n        t.unshift(SCOPE_TOKEN);\n    });\n}\n\nfunction compileToken(token, options, context){\n    token = token.filter(function(t){ return t.length > 0; });\n\n\ttoken.forEach(sortRules);\n\n\tvar isArrayContext = Array.isArray(context);\n\n    context = (options && options.context) || context;\n\n    if(context && !isArrayContext) context = [context];\n\n    absolutize(token, context);\n\n\treturn token\n\t\t.map(function(rules){ return compileRules(rules, options, context, isArrayContext); })\n\t\t.reduce(reduceRules, falseFunc);\n}\n\nfunction isTraversal(t){\n\treturn procedure[t.type] < 0;\n}\n\nfunction compileRules(rules, options, context, isArrayContext){\n\tvar acceptSelf = (isArrayContext && rules[0].name === \"scope\" && rules[1].type === \"descendant\");\n\treturn rules.reduce(function(func, rule, index){\n\t\tif(func === falseFunc) return func;\n\t\treturn Rules[rule.type](func, rule, options, context, acceptSelf && index === 1);\n\t}, options && options.rootFunc || trueFunc);\n}\n\nfunction reduceRules(a, b){\n\tif(b === falseFunc || a === trueFunc){\n\t\treturn a;\n\t}\n\tif(a === falseFunc || b === trueFunc){\n\t\treturn b;\n\t}\n\n\treturn function combine(elem){\n\t\treturn a(elem) || b(elem);\n\t};\n}\n\n//:not, :has and :matches have to compile selectors\n//doing this in lib/pseudos.js would lead to circular dependencies,\n//so we add them here\n\nvar Pseudos     = require(\"./pseudos.js\"),\n    filters     = Pseudos.filters,\n    existsOne   = DomUtils.existsOne,\n    isTag       = DomUtils.isTag,\n    getChildren = DomUtils.getChildren;\n\n\nfunction containsTraversal(t){\n\treturn t.some(isTraversal);\n}\n\nfilters.not = function(next, token, options, context){\n\tvar opts = {\n\t    \txmlMode: !!(options && options.xmlMode),\n\t    \tstrict: !!(options && options.strict)\n\t    };\n\n\tif(opts.strict){\n\t\tif(token.length > 1 || token.some(containsTraversal)){\n\t\t\tthrow new SyntaxError(\"complex selectors in :not aren't allowed in strict mode\");\n\t\t}\n\t}\n\n    var func = compileToken(token, opts, context);\n\n\tif(func === falseFunc) return next;\n\tif(func === trueFunc)  return falseFunc;\n\n\treturn function(elem){\n\t\treturn !func(elem) && next(elem);\n\t};\n};\n\nfilters.has = function(next, token, options){\n\tvar opts = {\n\t\txmlMode: !!(options && options.xmlMode),\n\t\tstrict: !!(options && options.strict)\n\t};\n\n    //FIXME: Uses an array as a pointer to the current element (side effects)\n    var context = token.some(containsTraversal) ? [PLACEHOLDER_ELEMENT] : null;\n\n\tvar func = compileToken(token, opts, context);\n\n\tif(func === falseFunc) return falseFunc;\n\tif(func === trueFunc)  return function(elem){\n\t\t\treturn getChildren(elem).some(isTag) && next(elem);\n\t\t};\n\n\tfunc = wrap(func);\n\n    if(context){\n        return function has(elem){\n\t\treturn next(elem) && (\n                (context[0] = elem), existsOne(func, getChildren(elem))\n            );\n\t};\n    }\n\n    return function has(elem){\n\t\treturn next(elem) && existsOne(func, getChildren(elem));\n\t};\n};\n\nfilters.matches = function(next, token, options, context){\n\tvar opts = {\n\t\txmlMode: !!(options && options.xmlMode),\n\t\tstrict: !!(options && options.strict),\n\t\trootFunc: next\n\t};\n\n\treturn compileToken(token, opts, context);\n};\n"]},"metadata":{},"sourceType":"script"}