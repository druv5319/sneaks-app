{"ast":null,"code":"(function () {\n  'use strict';\n\n  var assign = require('object-assign');\n\n  var vary = require('vary');\n\n  var defaults = {\n    origin: '*',\n    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n    preflightContinue: false,\n    optionsSuccessStatus: 204\n  };\n\n  function isString(s) {\n    return typeof s === 'string' || s instanceof String;\n  }\n\n  function isOriginAllowed(origin, allowedOrigin) {\n    if (Array.isArray(allowedOrigin)) {\n      for (var i = 0; i < allowedOrigin.length; ++i) {\n        if (isOriginAllowed(origin, allowedOrigin[i])) {\n          return true;\n        }\n      }\n\n      return false;\n    } else if (isString(allowedOrigin)) {\n      return origin === allowedOrigin;\n    } else if (allowedOrigin instanceof RegExp) {\n      return allowedOrigin.test(origin);\n    } else {\n      return !!allowedOrigin;\n    }\n  }\n\n  function configureOrigin(options, req) {\n    var requestOrigin = req.headers.origin,\n        headers = [],\n        isAllowed;\n\n    if (!options.origin || options.origin === '*') {\n      // allow any origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: '*'\n      }]);\n    } else if (isString(options.origin)) {\n      // fixed origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: options.origin\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    } else {\n      isAllowed = isOriginAllowed(requestOrigin, options.origin); // reflect origin\n\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: isAllowed ? requestOrigin : false\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    }\n\n    return headers;\n  }\n\n  function configureMethods(options) {\n    var methods = options.methods;\n\n    if (methods.join) {\n      methods = options.methods.join(','); // .methods is an array, so turn it into a string\n    }\n\n    return {\n      key: 'Access-Control-Allow-Methods',\n      value: methods\n    };\n  }\n\n  function configureCredentials(options) {\n    if (options.credentials === true) {\n      return {\n        key: 'Access-Control-Allow-Credentials',\n        value: 'true'\n      };\n    }\n\n    return null;\n  }\n\n  function configureAllowedHeaders(options, req) {\n    var allowedHeaders = options.allowedHeaders || options.headers;\n    var headers = [];\n\n    if (!allowedHeaders) {\n      allowedHeaders = req.headers['access-control-request-headers']; // .headers wasn't specified, so reflect the request headers\n\n      headers.push([{\n        key: 'Vary',\n        value: 'Access-Control-Request-Headers'\n      }]);\n    } else if (allowedHeaders.join) {\n      allowedHeaders = allowedHeaders.join(','); // .headers is an array, so turn it into a string\n    }\n\n    if (allowedHeaders && allowedHeaders.length) {\n      headers.push([{\n        key: 'Access-Control-Allow-Headers',\n        value: allowedHeaders\n      }]);\n    }\n\n    return headers;\n  }\n\n  function configureExposedHeaders(options) {\n    var headers = options.exposedHeaders;\n\n    if (!headers) {\n      return null;\n    } else if (headers.join) {\n      headers = headers.join(','); // .headers is an array, so turn it into a string\n    }\n\n    if (headers && headers.length) {\n      return {\n        key: 'Access-Control-Expose-Headers',\n        value: headers\n      };\n    }\n\n    return null;\n  }\n\n  function configureMaxAge(options) {\n    var maxAge = (typeof options.maxAge === 'number' || options.maxAge) && options.maxAge.toString();\n\n    if (maxAge && maxAge.length) {\n      return {\n        key: 'Access-Control-Max-Age',\n        value: maxAge\n      };\n    }\n\n    return null;\n  }\n\n  function applyHeaders(headers, res) {\n    for (var i = 0, n = headers.length; i < n; i++) {\n      var header = headers[i];\n\n      if (header) {\n        if (Array.isArray(header)) {\n          applyHeaders(header, res);\n        } else if (header.key === 'Vary' && header.value) {\n          vary(res, header.value);\n        } else if (header.value) {\n          res.setHeader(header.key, header.value);\n        }\n      }\n    }\n  }\n\n  function cors(options, req, res, next) {\n    var headers = [],\n        method = req.method && req.method.toUpperCase && req.method.toUpperCase();\n\n    if (method === 'OPTIONS') {\n      // preflight\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureMethods(options, req));\n      headers.push(configureAllowedHeaders(options, req));\n      headers.push(configureMaxAge(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n\n      if (options.preflightContinue) {\n        next();\n      } else {\n        // Safari (and potentially other browsers) need content-length 0,\n        //   for 204 or they just hang waiting for a body\n        res.statusCode = options.optionsSuccessStatus;\n        res.setHeader('Content-Length', '0');\n        res.end();\n      }\n    } else {\n      // actual response\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n      next();\n    }\n  }\n\n  function middlewareWrapper(o) {\n    // if options are static (either via defaults or custom options passed in), wrap in a function\n    var optionsCallback = null;\n\n    if (typeof o === 'function') {\n      optionsCallback = o;\n    } else {\n      optionsCallback = function (req, cb) {\n        cb(null, o);\n      };\n    }\n\n    return function corsMiddleware(req, res, next) {\n      optionsCallback(req, function (err, options) {\n        if (err) {\n          next(err);\n        } else {\n          var corsOptions = assign({}, defaults, options);\n          var originCallback = null;\n\n          if (corsOptions.origin && typeof corsOptions.origin === 'function') {\n            originCallback = corsOptions.origin;\n          } else if (corsOptions.origin) {\n            originCallback = function (origin, cb) {\n              cb(null, corsOptions.origin);\n            };\n          }\n\n          if (originCallback) {\n            originCallback(req.headers.origin, function (err2, origin) {\n              if (err2 || !origin) {\n                next(err2);\n              } else {\n                corsOptions.origin = origin;\n                cors(corsOptions, req, res, next);\n              }\n            });\n          } else {\n            next();\n          }\n        }\n      });\n    };\n  } // can pass either an options hash, an options delegate, or nothing\n\n\n  module.exports = middlewareWrapper;\n})();","map":{"version":3,"sources":["/Users/dhruv/Sneaks/sneaks-website/node_modules/cors/lib/index.js"],"names":["assign","require","vary","defaults","origin","methods","preflightContinue","optionsSuccessStatus","isString","s","String","isOriginAllowed","allowedOrigin","Array","isArray","i","length","RegExp","test","configureOrigin","options","req","requestOrigin","headers","isAllowed","push","key","value","configureMethods","join","configureCredentials","credentials","configureAllowedHeaders","allowedHeaders","configureExposedHeaders","exposedHeaders","configureMaxAge","maxAge","toString","applyHeaders","res","n","header","setHeader","cors","next","method","toUpperCase","statusCode","end","middlewareWrapper","o","optionsCallback","cb","corsMiddleware","err","corsOptions","originCallback","err2","module","exports"],"mappings":"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","sourcesContent":["(function () {\n\n  'use strict';\n\n  var assign = require('object-assign');\n  var vary = require('vary');\n\n  var defaults = {\n    origin: '*',\n    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n    preflightContinue: false,\n    optionsSuccessStatus: 204\n  };\n\n  function isString(s) {\n    return typeof s === 'string' || s instanceof String;\n  }\n\n  function isOriginAllowed(origin, allowedOrigin) {\n    if (Array.isArray(allowedOrigin)) {\n      for (var i = 0; i < allowedOrigin.length; ++i) {\n        if (isOriginAllowed(origin, allowedOrigin[i])) {\n          return true;\n        }\n      }\n      return false;\n    } else if (isString(allowedOrigin)) {\n      return origin === allowedOrigin;\n    } else if (allowedOrigin instanceof RegExp) {\n      return allowedOrigin.test(origin);\n    } else {\n      return !!allowedOrigin;\n    }\n  }\n\n  function configureOrigin(options, req) {\n    var requestOrigin = req.headers.origin,\n      headers = [],\n      isAllowed;\n\n    if (!options.origin || options.origin === '*') {\n      // allow any origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: '*'\n      }]);\n    } else if (isString(options.origin)) {\n      // fixed origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: options.origin\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    } else {\n      isAllowed = isOriginAllowed(requestOrigin, options.origin);\n      // reflect origin\n      headers.push([{\n        key: 'Access-Control-Allow-Origin',\n        value: isAllowed ? requestOrigin : false\n      }]);\n      headers.push([{\n        key: 'Vary',\n        value: 'Origin'\n      }]);\n    }\n\n    return headers;\n  }\n\n  function configureMethods(options) {\n    var methods = options.methods;\n    if (methods.join) {\n      methods = options.methods.join(','); // .methods is an array, so turn it into a string\n    }\n    return {\n      key: 'Access-Control-Allow-Methods',\n      value: methods\n    };\n  }\n\n  function configureCredentials(options) {\n    if (options.credentials === true) {\n      return {\n        key: 'Access-Control-Allow-Credentials',\n        value: 'true'\n      };\n    }\n    return null;\n  }\n\n  function configureAllowedHeaders(options, req) {\n    var allowedHeaders = options.allowedHeaders || options.headers;\n    var headers = [];\n\n    if (!allowedHeaders) {\n      allowedHeaders = req.headers['access-control-request-headers']; // .headers wasn't specified, so reflect the request headers\n      headers.push([{\n        key: 'Vary',\n        value: 'Access-Control-Request-Headers'\n      }]);\n    } else if (allowedHeaders.join) {\n      allowedHeaders = allowedHeaders.join(','); // .headers is an array, so turn it into a string\n    }\n    if (allowedHeaders && allowedHeaders.length) {\n      headers.push([{\n        key: 'Access-Control-Allow-Headers',\n        value: allowedHeaders\n      }]);\n    }\n\n    return headers;\n  }\n\n  function configureExposedHeaders(options) {\n    var headers = options.exposedHeaders;\n    if (!headers) {\n      return null;\n    } else if (headers.join) {\n      headers = headers.join(','); // .headers is an array, so turn it into a string\n    }\n    if (headers && headers.length) {\n      return {\n        key: 'Access-Control-Expose-Headers',\n        value: headers\n      };\n    }\n    return null;\n  }\n\n  function configureMaxAge(options) {\n    var maxAge = (typeof options.maxAge === 'number' || options.maxAge) && options.maxAge.toString()\n    if (maxAge && maxAge.length) {\n      return {\n        key: 'Access-Control-Max-Age',\n        value: maxAge\n      };\n    }\n    return null;\n  }\n\n  function applyHeaders(headers, res) {\n    for (var i = 0, n = headers.length; i < n; i++) {\n      var header = headers[i];\n      if (header) {\n        if (Array.isArray(header)) {\n          applyHeaders(header, res);\n        } else if (header.key === 'Vary' && header.value) {\n          vary(res, header.value);\n        } else if (header.value) {\n          res.setHeader(header.key, header.value);\n        }\n      }\n    }\n  }\n\n  function cors(options, req, res, next) {\n    var headers = [],\n      method = req.method && req.method.toUpperCase && req.method.toUpperCase();\n\n    if (method === 'OPTIONS') {\n      // preflight\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureMethods(options, req));\n      headers.push(configureAllowedHeaders(options, req));\n      headers.push(configureMaxAge(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n\n      if (options.preflightContinue) {\n        next();\n      } else {\n        // Safari (and potentially other browsers) need content-length 0,\n        //   for 204 or they just hang waiting for a body\n        res.statusCode = options.optionsSuccessStatus;\n        res.setHeader('Content-Length', '0');\n        res.end();\n      }\n    } else {\n      // actual response\n      headers.push(configureOrigin(options, req));\n      headers.push(configureCredentials(options, req));\n      headers.push(configureExposedHeaders(options, req));\n      applyHeaders(headers, res);\n      next();\n    }\n  }\n\n  function middlewareWrapper(o) {\n    // if options are static (either via defaults or custom options passed in), wrap in a function\n    var optionsCallback = null;\n    if (typeof o === 'function') {\n      optionsCallback = o;\n    } else {\n      optionsCallback = function (req, cb) {\n        cb(null, o);\n      };\n    }\n\n    return function corsMiddleware(req, res, next) {\n      optionsCallback(req, function (err, options) {\n        if (err) {\n          next(err);\n        } else {\n          var corsOptions = assign({}, defaults, options);\n          var originCallback = null;\n          if (corsOptions.origin && typeof corsOptions.origin === 'function') {\n            originCallback = corsOptions.origin;\n          } else if (corsOptions.origin) {\n            originCallback = function (origin, cb) {\n              cb(null, corsOptions.origin);\n            };\n          }\n\n          if (originCallback) {\n            originCallback(req.headers.origin, function (err2, origin) {\n              if (err2 || !origin) {\n                next(err2);\n              } else {\n                corsOptions.origin = origin;\n                cors(corsOptions, req, res, next);\n              }\n            });\n          } else {\n            next();\n          }\n        }\n      });\n    };\n  }\n\n  // can pass either an options hash, an options delegate, or nothing\n  module.exports = middlewareWrapper;\n\n}());\n"]},"metadata":{},"sourceType":"script"}